define(["jquery","component/Popup","utils","jquery-ui","ui/gallery"],function(a,b,c){function d(b,c){var d=this;c=c||m,a.each(b,function(a,e){f(a,c).call(d,e,a,b,g.call(d,a))})}function e(b){return b=a.extend({},m,b),function(a){d.call(this,a,b)}}function f(a,b){var c=b[a];return c?"string"==typeof c?b[c]:c:b["default"]}function g(a){return this.find("[data-name='"+a+"']")}function h(a,b){var c=this;this[0]=this.element=1===a.nodeType?a:a[0],this.length=1,this.widget=b,this.data("instance",this),this.setValue=function(){h.prototype.setValue.apply(c,arguments)},this.create()}function i(a,b){var c=/^[\.#]/.test(a);return void 0===b?c?this.find(a).text():this.data(a):(c?this.find(a).text(b):this.data(a,b),b)}var j,k,l=c.dataConvert(),m={"default":function(a,b,c,d){var d;a=a?a:"",d.length&&d.text(l(c,b))},memo:function(a,b,c,d){d.length&&d.html(l(c,b))},fileType:function(a,b,c,d){var e="/resource/"+c.parentPath+"/"+c.saveName+"."+c.fileType;className="icon-static-file-"+a,e+="?filename="+c.filename,d[0].className="",d.addClass(className).attr("href",e)}},n={},o=a.extend({},{version:"1.1",options:n,_create:function(){k=this.widgetFullName,j=this.widgetSelectorPrefix=k+"-";var b=this,c=this.options;h.fn.extend(c.extendOfItem),this.access("customer-selector",a("._customer-select").detach()),this.access("status",{editor:null,popup:!1}),this.length=0,this.find("._work-wrap").each(function(a,c){b[b.length++]=new h(c,b).addClass(b.widgetFullName+"-item")}),this._initUI(),this._registerEvent()},_init:function(){},_destroy:function(){var a=this.items.getItem(),b=null;for(a.length;b=a.pop();)this.option("deleteItem").call(this,b.remove()),this._reflesh();this.items.destroy(),this.element.remove()},find:function(b,c){return a(b,c||this.element)},access:c.access,status:function(a,b){return void 0===a?this.access("status"):(a="status."+a,void 0===b?this.access(a):this.access(a,b))}},{},{_initUI:function(){var b=this;this.editorElement=a("#editor").on("popOn",function(a){b.status("popup",!0)}).on("popOff",function(a){b.status("editor").refresh(),b.status("editor",null),b.status("popup",!1)})},popup:b,editor:function(a,b){return a===!1?this.editorElement.editorTabs("disable"):(this.status("editor",b),this.popup(this.editorElement.editorTabs(a))),this},popInfo:function(a,b){d.call(a,b),this.popup(a)},convertor:c.dataConvert()},{_globalEvent:{},_registerEvent:function(){var b=this,c=h.prototype,d={};a.each(c.eventHandlers,function(e,f){f="string"==typeof f?c[f]:f,d[e]=function(c){target=a(c.target),c.item=target.closest("."+j+"item").data("instance"),f.apply(b,arguments)}}),this._on(d),d={},a.each(this._globalEvent,function(c,e){a.isFunction(e)?d[c]=e:b._on(c,e)}),this._on(d)}}),p=(a.widget("ui.itemContainer",o),a("#ui-gallery").gallery().on("popOff",function(b){a(this).data("itemObj").draftFile()}).gallery("instance"));h.fn=h.prototype=a(),h.fn.extend({access:i,create:function(){this.id=this.access("workId"),this.customer=this.access("customerId"),this.state=this.access("workState"),this.resourceFile(),this.confirmFile(),this.draftFile()},destroy:function(){return this},refresh:function(){var b=this;a.getJSON("/admin/work/editor/get/"+this.id).success(function(a){b.setValue(a),b.resourceFile(),b.confirmFile(),b.draftFile()})},resourceUpload:function(b,c,d){var e=this,f=new FormData;return a.each(c,function(a,b){f.append("file",b)}),f.append("work",this.id),f.append("serviceType",b),a.ajax({url:"/admin/work/editor/resource/upload",processData:!1,contentType:!1,data:f,type:"POST"}).success(function(){d.call(e)}),!1},getResource:function(b,c){var d=this;a.getJSON("/admin/work/editor/resource/list",{work:this.id,serviceType:b}).success(function(a){c.call(d,a)})},removeResource:function(b,c,d){var e=this;a.ajax({url:"/admin/work/editor/resource/delete/"+c,type:"GET",data:{work:item.id,serviceType:b}}).success(function(a){d.call(e)})},gallery:function(){this.getResource("workDraftFile",function(b){var c=this,d=[];p._init(),p.options.removeHandler=function(b,d){var e=!1;return a.ajaxSetup({async:!1}),c.removeResource("workDraftFile",d.id,function(a){e=!0}),a.ajaxSetup({async:!0}),e},p.options.addHandler=function(a){c.resourceUpload("workDraftFile",a,function(){this.gallery()})},a.each(b,function(a,b){d.push({id:b.id,src:"/resource/"+b.parentPath+"/"+b.saveName+"."+b.fileType,thumbnail:"/resource/"+b.parentPath+"/"+b.saveName+"-thumbnail."+b.fileType,filename:b.originalName+"."+b.fileType,length:b.size,datetime:b.uploadTime})}),p.put(d),d.length&&p.view(0),this.widget.popup(p.element.data("itemObj",this))})},resourceFile:function(){var b=this.find("._pop-file-refer");a.getJSON("/admin/work/get/resource/size/"+this.id).success(function(a){a.size>0?(b.removeClass("disable"),b.find(".size").text(a.size)):b.addClass("disable")})},confirmFile:function(){var b=this,c=b.find(".btn-work-file"),e=a(c.data("uiDropdown"));this.getResource("workConfirmFile",function(a){a=a[0],a?(c.removeClass("disable"),a.filename=b.id+"_"+b.getValue(["customer","item"]).join("_")+"."+a.fileType,d.call(e,a)):c.addClass("disable")})},draftFile:function(){this.getResource("workDraftFile",function(a){var b=this.find("._work-img").empty();return(a=a[0])?void b.append('<img src="/resource/'+a.parentPath+"/"+a.saveName+"-thumbnail."+a.fileType+'">').removeClass("empty"):(b.addClass("empty"),this)})},editor:function(b){var c=this,d=this.widget;a.ajax("/admin/work/editor/init/"+this.id).success(function(){b=a.extend(b,{item:c}),d.editor(b,c)})},setValue:e({afterProcess:function(a,b,c,d){a?g.call(this,"itemDetail").next().removeClass("ui-helper-hidden"):g.call(this,"itemDetail").next().addClass("ui-helper-hidden")},memo:function(a,b,c,d){a?(this.find(".btn-memo").removeClass("disable"),m.memo.apply(this,arguments)):this.find(".btn-memo").addClass("disable")},delivery:function(b,c,d,e){var f=["fa-cubes","fa-male","fa-truck"],g=b.ordinal;a.each(f,function(a,c){a==g?(e.attr("alt",b.value),e.addClass(c)):e.removeClass(c)})},count:function(a,b,c,d){var e=c.num?"("+c.num+"건)":"";d.text(a+" "+e)},subcontractor:function(a,b,c,d){this.find("[data-info='subcontractor']").attr("data-info-key",a.id),d.text(a.name)},manager:function(a,b,c,d){var e=d,f=g.call(this,"manager.position");null!=a?(e.text(a.name).attr("data-info-key",a.id).attr("data-info","manager"),f.text(a.position)):(e.text("담당자 없음").attr("data-info-key","").removeAttr("data-info"),f.text(""))},insertTime:function(a,b,c,d){}}),getValue:function(b,c){var d=c||this;return a.each(b,function(a,c){b[a]=g.call(d,c).text()}),b}})});
//# sourceMappingURL=itemContainer.js.map